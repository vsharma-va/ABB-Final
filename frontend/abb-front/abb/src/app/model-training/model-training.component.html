<div class="training-container">
  <h2>Model Training & Evaluation</h2>
  
  <div *ngIf="!trainingComplete" class="training-controls">
    <div class="model-selection mb-4">
      <label for="modelType" class="form-label">Select Model Type:</label>
      <select id="modelType" class="form-select" [(ngModel)]="modelType">
        <option value="xgboost">XGBoost</option>
        <option value="random_forest">Random Forest</option>
        <option value="logistic_regression">Logistic Regression</option>
      </select>
    </div>
    
    <p>Click the button below to start training the model with the selected date ranges.</p>
    <button 
      class="btn btn-primary" 
      (click)="trainModel()" 
      [disabled]="trainingInProgress || isLoading">
      {{ trainingInProgress ? 'Training in progress...' : 'Train Model' }}
    </button>
    
    <div *ngIf="trainingInProgress" class="mt-3">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Training...</span>
      </div>
      <p class="mt-2">Training model. This may take a few minutes...</p>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger mt-3">
    {{ error }}
  </div>

  <div *ngIf="trainingComplete && metrics" class="results-container">
    <div class="metrics-summary">
      <h3>Model Performance Summary</h3>
      <div class="metrics-grid">
        <div class="metric-card">
          <h4>Accuracy</h4>
          <div class="metric-value">{{ (metrics.Metrics.Accuracy).toFixed(2) }}%</div>
        </div>
        <div class="metric-card">
          <h4>Precision</h4>
          <div class="metric-value">{{ (metrics.Metrics.Precision).toFixed(2) }}%</div>
        </div>
        <div class="metric-card">
          <h4>Recall</h4>
          <div class="metric-value">{{ (metrics.Metrics.Recall).toFixed(2) }}%</div>
        </div>
        <div class="metric-card">
          <h4>F1-Score</h4>
          <div class="metric-value">{{ (metrics.Metrics.F1).toFixed(2) }}%</div>
        </div>
      </div>
      
      <div class="model-id mt-3">
        <small class="text-muted">Model ID: {{ metrics.ModelId }}</small>
      </div>
    </div>

    <div class="charts-container">
      <div class="chart-card">
        <h4>Training Progress</h4>
        <div class="chart-wrapper">
          <canvas id="lossChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <h4>Confusion Matrix</h4>
        <div class="chart-wrapper">
          <canvas id="confusionMatrixChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="confusion-matrix-details mt-4">
      <h4>Confusion Matrix Details</h4>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th></th>
              <th>Predicted Positive</th>
              <th>Predicted Negative</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>Actual Positive</th>
              <td class="table-success">True Positives: {{ metrics.Confusion.TP }}</td>
              <td class="table-danger">False Negatives: {{ metrics.Confusion.FN }}</td>
            </tr>
            <tr>
              <th>Actual Negative</th>
              <td class="table-warning">False Positives: {{ metrics.Confusion.FP }}</td>
              <td class="table-info">True Negatives: {{ metrics.Confusion.TN }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="actions mt-4">
    <button class="btn btn-secondary me-2" (click)="navigateBack()">
      <i class="bi bi-arrow-left"></i> Back to Date Ranges
    </button>
    <button *ngIf="trainingComplete" 
            class="btn btn-primary" 
            (click)="navigateToSimulation()"
            [disabled]="!trainingComplete">
      Proceed to Simulation <i class="bi bi-arrow-right"></i>
    </button>
  </div>
</div>
